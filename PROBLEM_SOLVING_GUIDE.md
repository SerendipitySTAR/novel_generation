# é—®é¢˜è§£å†³æŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©æ‚¨è§£å†³å°è¯´ç”Ÿæˆç³»ç»Ÿä¸­çš„ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š

## ğŸ”§ é—®é¢˜1: äººç‰©è®°å¿†æ··æ‚

### é—®é¢˜æè¿°
ä¸åŒæ•…äº‹ä¹‹é—´çš„äººç‰©è®°å¿†å‡ºç°æ··æ‚ï¼Œå¯¼è‡´è§’è‰²ä¿¡æ¯é”™ä¹±ã€‚

### è§£å†³æ–¹æ¡ˆ

#### 1. è¯Šæ–­é—®é¢˜
```bash
python -m src.utils.problem_solver diagnose
```

#### 2. æŸ¥çœ‹æ‰€æœ‰å°è¯´
```bash
python -m src.utils.problem_solver list
```

#### 3. ä¿®å¤ç‰¹å®šå°è¯´çš„è®°å¿†é—®é¢˜
```bash
# äº¤äº’å¼ä¿®å¤
python -m src.utils.problem_solver fix --novel-id 1

# éäº¤äº’å¼ä¿®å¤ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
python -m src.utils.problem_solver fix --novel-id 1 --non-interactive
```

#### 4. ä¿®å¤æ‰€æœ‰è®°å¿†é—®é¢˜
```bash
python -m src.utils.problem_solver fix
```

### æ‰‹åŠ¨ç®¡ç†é€‰é¡¹

#### åˆ é™¤ç‰¹å®šè§’è‰²
```python
from src.utils.memory_manager import MemoryManager

memory_manager = MemoryManager()
# åˆ é™¤è§’è‰²IDä¸º5çš„è§’è‰²
memory_manager.delete_specific_character(5)
```

#### æ›´æ–°è§’è‰²ä¿¡æ¯
```python
# æ›´æ–°è§’è‰²ä¿¡æ¯
memory_manager.update_character_info(
    character_id=5,
    name="æ–°åå­—",
    description="æ–°æè¿°"
)
```

#### æ¸…é™¤æ•´ä¸ªå°è¯´çš„è®°å¿†
```python
# æ¸…é™¤è§’è‰²å’ŒçŸ¥è¯†åº“ï¼Œä¿ç•™ç« èŠ‚
result = memory_manager.clear_novel_memory(
    novel_id=1,
    clear_characters=True,
    clear_chapters=False,
    clear_knowledge_base=True
)
```

## ğŸ”„ é—®é¢˜2: å¾ªç¯å¯¼è‡´ç³»ç»Ÿå¡æ­»

### é—®é¢˜æè¿°
å·¥ä½œæµç¨‹é™·å…¥æ— é™å¾ªç¯ï¼Œå ç”¨å¤§é‡CPUèµ„æºï¼Œå¯¼è‡´ç³»ç»Ÿå¡æ­»ã€‚

### å·²å®æ–½çš„è§£å†³æ–¹æ¡ˆ

#### 1. å¾ªç¯ä¿æŠ¤æœºåˆ¶
- **æœ€å¤§è¿­ä»£æ¬¡æ•°é™åˆ¶**: æ¯ä¸ªå°è¯´çš„ç« èŠ‚ç”Ÿæˆå¾ªç¯æœ€å¤šæ‰§è¡Œ `ç« èŠ‚æ•° Ã— 3` æ¬¡è¿­ä»£
- **å¼‚å¸¸çŠ¶æ€æ£€æµ‹**: æ£€æµ‹ç« èŠ‚å·æ˜¯å¦å¼‚å¸¸å¢é•¿
- **å®‰å…¨é€€å‡ºæ¡ä»¶**: å½“æ£€æµ‹åˆ°å¼‚å¸¸æ—¶å¼ºåˆ¶é€€å‡ºå¾ªç¯

#### 2. é€’å½’é™åˆ¶ä¼˜åŒ–
- **åŠ¨æ€è®¡ç®—**: æ ¹æ®ç« èŠ‚æ•°åŠ¨æ€è®¡ç®—é€’å½’é™åˆ¶
- **ç¼“å†²åŒº**: æ·»åŠ é¢å¤–çš„ç¼“å†²åŒºä»¥å¤„ç†é‡è¯•æƒ…å†µ

#### 3. ç›‘æ§å’Œè¯Šæ–­
```bash
# æ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶æ€
python -m src.utils.problem_solver health
```

#### 4. ç´§æ€¥åœæ­¢
```bash
# å¦‚æœç³»ç»Ÿé™·å…¥å¾ªç¯ï¼Œæ‰§è¡Œç´§æ€¥åœæ­¢
python -m src.utils.problem_solver emergency-stop
```

### é¢„é˜²æªæ–½

#### 1. è®¾ç½®åˆç†çš„å‚æ•°
```python
# åœ¨è¿è¡Œå·¥ä½œæµç¨‹æ—¶è®¾ç½®è¾ƒå°çš„ç« èŠ‚æ•°è¿›è¡Œæµ‹è¯•
user_input = {
    "theme": "æµ‹è¯•ä¸»é¢˜",
    "chapters": 2,  # å…ˆç”¨è¾ƒå°çš„æ•°å­—æµ‹è¯•
    "words_per_chapter": 500
}
```

#### 2. ç›‘æ§æ‰§è¡Œè¿‡ç¨‹
- è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºä¸­çš„å¾ªç¯è®¡æ•°å™¨
- æ³¨æ„ "SAFETY" ç›¸å…³çš„è­¦å‘Šä¿¡æ¯
- å¦‚æœçœ‹åˆ°é‡å¤çš„å¾ªç¯ä¿¡æ¯ï¼Œç«‹å³åœæ­¢ç¨‹åº

#### 3. ä½¿ç”¨è¶…æ—¶æœºåˆ¶
```python
import signal
import time

def timeout_handler(signum, frame):
    raise TimeoutError("å·¥ä½œæµç¨‹æ‰§è¡Œè¶…æ—¶")

# è®¾ç½®30åˆ†é’Ÿè¶…æ—¶
signal.signal(signal.SIGALRM, timeout_handler)
signal.alarm(1800)  # 30åˆ†é’Ÿ

try:
    result = workflow_manager.run_workflow(user_input)
finally:
    signal.alarm(0)  # å–æ¶ˆè¶…æ—¶
```

## ğŸ› ï¸ é«˜çº§æ•…éšœæ’é™¤

### 1. æ•°æ®åº“é—®é¢˜
```python
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
from src.persistence.database_manager import DatabaseManager
db = DatabaseManager()
novels = db.get_all_novels()  # å¦‚æœå¤±è´¥ï¼Œè¯´æ˜æ•°æ®åº“æœ‰é—®é¢˜
```

### 2. çŸ¥è¯†åº“é—®é¢˜
```python
# æ£€æŸ¥çŸ¥è¯†åº“çŠ¶æ€
from src.knowledge_base.knowledge_base_manager import KnowledgeBaseManager
kb = KnowledgeBaseManager()
collections = kb.list_collections()
print(f"ç°æœ‰é›†åˆ: {collections}")
```

### 3. å†…å­˜æ³„æ¼æ£€æŸ¥
```bash
# ä½¿ç”¨ç³»ç»Ÿç›‘æ§å·¥å…·
top -p $(pgrep -f python)
# æˆ–
htop
```

### 4. æ—¥å¿—åˆ†æ
- æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºä¸­çš„é”™è¯¯ä¿¡æ¯
- æ³¨æ„å†…å­˜ä½¿ç”¨æƒ…å†µ
- ç›‘æ§CPUä½¿ç”¨ç‡

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. å®šæœŸæ¸…ç†
- æ¯æ¬¡å¼€å§‹æ–°é¡¹ç›®å‰è¿è¡Œè¯Šæ–­
- å®šæœŸæ¸…ç†ä¸éœ€è¦çš„å°è¯´æ•°æ®
- å¤‡ä»½é‡è¦çš„è®°å¿†æ•°æ®

### 2. æµ‹è¯•ç­–ç•¥
- å…ˆç”¨å°è§„æ¨¡å‚æ•°æµ‹è¯•ï¼ˆ1-2ç« èŠ‚ï¼‰
- é€æ­¥å¢åŠ å¤æ‚åº¦
- åœ¨ç”Ÿäº§ç¯å¢ƒå‰å……åˆ†æµ‹è¯•

### 3. ç›‘æ§ç­–ç•¥
- è®¾ç½®æ‰§è¡Œè¶…æ—¶
- ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨
- ä¿æŒæ—¥å¿—è®°å½•

### 4. å¤‡ä»½ç­–ç•¥
```bash
# å¯¼å‡ºé‡è¦å°è¯´çš„è®°å¿†å¤‡ä»½
python -m src.utils.problem_solver fix --novel-id 1
# é€‰æ‹©é€‰é¡¹4è¿›è¡Œå¤‡ä»½
```

## ğŸ†˜ ç´§æ€¥æƒ…å†µå¤„ç†

### å¦‚æœç³»ç»Ÿå®Œå…¨å¡æ­»ï¼š
1. **å¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹**:
   ```bash
   pkill -f "python.*novel"
   ```

2. **æ£€æŸ¥ç³»ç»Ÿèµ„æº**:
   ```bash
   free -h  # æ£€æŸ¥å†…å­˜
   df -h    # æ£€æŸ¥ç£ç›˜ç©ºé—´
   ```

3. **æ¸…ç†ä¸´æ—¶æ–‡ä»¶**:
   ```bash
   rm -rf ./chroma_db/*  # æ¸…ç†çŸ¥è¯†åº“ï¼ˆè°¨æ…æ“ä½œï¼‰
   ```

4. **é‡å¯ç³»ç»Ÿ**ï¼ˆæœ€åæ‰‹æ®µï¼‰

### æ•°æ®æ¢å¤ï¼š
å¦‚æœæ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥ä»å¤‡ä»½æ–‡ä»¶æ¢å¤ï¼š
```python
import json
from src.utils.memory_manager import MemoryManager

# åŠ è½½å¤‡ä»½æ•°æ®
with open('novel_1_memory_backup.json', 'r') as f:
    backup_data = json.load(f)

# æ‰‹åŠ¨æ¢å¤æ•°æ®ï¼ˆéœ€è¦è‡ªå®šä¹‰å®ç°ï¼‰
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š
1. è¿è¡Œå®Œæ•´è¯Šæ–­: `python -m src.utils.problem_solver diagnose`
2. æ”¶é›†é”™è¯¯æ—¥å¿—å’Œç³»ç»Ÿä¿¡æ¯
3. æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å’Œå†…å­˜
4. è€ƒè™‘é™ä½å¹¶å‘åº¦æˆ–å‡å°‘ç« èŠ‚æ•°é‡

è®°ä½ï¼š**é¢„é˜²èƒœäºæ²»ç–—**ã€‚å®šæœŸç»´æŠ¤å’Œç›‘æ§å¯ä»¥é¿å…å¤§å¤šæ•°é—®é¢˜ã€‚
